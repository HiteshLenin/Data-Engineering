#'strings'
-----
use sakila;

select * from customer; 
# fixed Width
SELECT last_name, LPAD(last_name, 20, '*') AS left_padded
FROM customer
LIMIT 5;

SELECT last_name, LPAD(RPAD(last_name, 20, '*'),25,'*') AS left_padded
FROM customer
LIMIT 5;

-----
show databases;

use world;
show tables;
select * from city;

#Substring - Shortening names  
SELECT Name, SUBSTRING(Name, 1,5)  AS short_name 
FROM city;

#concatination -- Combining two column strings

SELECT CONCAT(Name, '-', CountryCode) AS name_code 
FROM city;
--------------------------
# Reversing
SELECT Name, REVERSE(Name) AS reversed_name
FROM city
LIMIT 5;

#length 

SELECT Name, LENGTH(Name) AS Name_length 
FROM city
WHERE LENGTH(Name) =8;
-------------------------------------
#substring with locate -

SELECT email,
       SUBSTRING(email, LOCATE('@', email) +1) AS domain
FROM sakila.customer;

SELECT 
  email,
  substring_index(SUBSTRING(email, LOCATE('@', email) + 1), '.', -1) AS domain
FROM 
  sakila.customer;

#substring_index
 
----------------
SELECT title, UPPER(title),lower(title)
FROM sakila.film
WHERE UPPER(title) LIKE '%LOVELY%' or UPPER(title) LIKE '%MAN';

select title, lower(title) as lower_titles
FROM sakila.film;

SELECT LEFT(title, 2) AS first_letter, right(title,3) as last_letter,  COUNT(*) AS film_count
FROM sakila.film
GROUP BY LEFT(title, 2), right(title,3)
ORDER BY film_count DESC;

use banking_case;
select * from customer;
SELECT LEFT(Name, 2) AS first_letter, left(Nationality, 3) as last_letter, count(*) as name_count
from banking_case.customer
GROUP BY LEFT(Name, 2), LEFT(Nationality, 3)
ORDER BY name_count DESC;

# Using of Case when(if, Else) 
SELECT Name,
       CASE 
           WHEN LEFT(Name, 1) BETWEEN 'A' AND 'M' THEN 'Group A-M'
           WHEN LEFT(Name, 1) BETWEEN 'N' AND 'Z' THEN 'Group N-Z'
           ELSE 'Other'
       END AS group_label
FROM banking_case.customer
       Order by group_label;
#Replace
SELECT title, REPLACE(title, 'B', '*') AS cleaned_title
FROM sakila.film
WHERE title LIKE '% %';

-- not contains 3 consecutive vowels 
SELECT customer_id, last_name
FROM sakila.customer
WHERE last_name REGEXP '[^aeiouAEIOU]{3}'; 

-- ends with vowel
SELECT lower(title)
FROM sakila.film
WHERE title REGEXP '[aeiouAEIOU]$';

 
select Name, right(Name,2)
FROM banking_case.customer
WHERE Name REGEXP '[eE]$';

-- count 

select right(Name,1), count(*)
FROM banking_case.customer
WHERE Name REGEXP '[aeiouAEIOU]$' 
group by right(Name,1)
;

SELECT title AS ending, right(title,1)
FROM sakila.film
WHERE title REGEXP '[Ee]$';

-- count 

select right(Name,1), count(*)
FROM banking_case.customer
WHERE Name REGEXP '[aeiouAEIOU]$' 
group by right(Name,1)
;

SELECT title AS ending, right(title,1)
FROM sakila.film
WHERE title REGEXP '[Ee]$';

#math 

SELECT title, rental_rate, rental_rate ^ 3 AS double_rate   -- debug why its allwoing string + integer
FROM sakila.film;

-- select amount,CAST(amount AS signed) AS amount_str from sakila.payment;  -- check type casting in mysql 
#math 

SELECT customer_id,
       COUNT(payment_id) AS payments,
       SUM(amount) AS total_paid,
       SUM(amount) / COUNT(payment_id) AS avg_payment
       
FROM sakila.payment
GROUP BY customer_id;

select rental_duration from sakila.film;


---------------------------------

SELECT Name, (RAND() * 100), FLOOR(RAND() * 100) AS random_score
FROM banking_case.customer
LIMIT 5;

SELECT film_id,rental_duration, POWER(rental_duration, 2) AS squared_duration
FROM sakila.film
LIMIT 5;

SELECT film_id,length, MOD(length, 60) AS minutes_over_hour
FROM sakila.film;

SELECT 
  length,
  FLOOR(length / 60) AS hours,
  MOD(length, 60) AS minutes
FROM sakila.film;

SELECT rental_rate, CEIL(rental_rate) AS ceil_value, FLOOR(rental_rate) AS floor_value
FROM sakila.film;

SELECT rental_rate, ROUND(replacement_cost / rental_rate, 0),ROUND(replacement_cost / rental_rate, 1) AS ratio
FROM sakila.film;

#date diff 

SELECT rental_id, return_date,rental_date, DATEDIFF(return_date, rental_date) AS days_rented
FROM sakila.rental
WHERE return_date IS NOT NULL;

#date time 

select last_update,dayname(last_update),monthname(last_update) from sakila.film;

SELECT 
    rental_date, year(rental_date)
FROM
   sakila.rental;
   
SELECT payment_date FROM sakila.payment;

SELECT payment_date, date(payment_date) AS pay_date, SUM(amount) AS total_paid
FROM sakila.payment
GROUP BY DATE(payment_date),payment_date
ORDER BY pay_date DESC;

Find Customers Who Paid in the Last 24 Hours

select * from sakila.payment;

SELECT customer_id, amount, payment_date
FROM sakila.payment
WHERE payment_date >= NOW() - INTERVAL 1 DAY;

select max(payment_date) FROM sakila.payment;

SELECT customer_id, amount, payment_date
FROM sakila.payment
WHERE payment_date >= (
    SELECT MAX(payment_date) - INTERVAL 10 day
    FROM sakila.payment
);

select now()  - INTERVAL 1 DAY as yesterday;


SELECT CONCAT('Today is: ', CURDATE()) AS message;
SELECT CONCAT('Today is: ', now()) AS message;
